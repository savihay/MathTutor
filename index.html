<!DOCTYPE html>
<html lang="he" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>לומדת הכנה למבחן מיון במתמטיקה</title>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                packages: ['base', 'ams', 'noerrors', 'noundefined']
            },
            svg: {
                fontCache: 'global'
            },
            startup: {
                ready: () => {
                    initializeApp();
                }
            }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
        </script>
    <style>
        body {
            font-family: Arial, sans-serif;
            direction: rtl;
            padding: 20px;
            max-width: 900px;
            margin: 0 auto;
            font-size: 18px;
            line-height: 1.6;
            overflow-x: hidden;
            /* Ensure confetti doesn't cause horizontal scrolling */
        }

        /* Optional: Add a container for confetti to ensure proper z-index stacking */
        .confetti-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 9999;
        }

        .module {
            border: 1px solid #ccc;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            background-color: #fff;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .section {
            margin-bottom: 20px;
        }

        .explanation-item,
        .example-item {
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .question {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        .options label {
            display: block;
            margin-bottom: 10px;
            cursor: pointer;
            padding: 8px;
            border-radius: 4px;
        }

        .options label:hover {
            background-color: #f0f0f0;
        }

        .options label.disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .options label.disabled:hover {
            background-color: transparent;
        }

        button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
            font-size: 16px;
        }

        button:hover {
            background-color: #0056b3;
        }

        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .feedback {
            margin-top: 10px;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
            background-color: transparent;
        }

        @keyframes celebrate {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.2);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes glow {
            0% {
                box-shadow: 0 0 5px #28a745;
            }

            50% {
                box-shadow: 0 0 20px #28a745;
            }

            100% {
                box-shadow: 0 0 5px #28a745;
            }
        }

        .feedback.correct {
            animation: celebrate 0.5s ease-in-out, glow 1s ease-in-out;
        }

        .correct {
            color: #28a745;
            background-color: #d4edda;
        }

        .incorrect {
            color: #dc3545;
            background-color: #f8d7da;
        }

        .navigation-buttons {
            margin: 15px 0;
        }

        .navigation-buttons button {
            margin: 0 5px;
        }

        .section-content {
            display: none;
            background-color: #fff;
        }

        .section-content.active {
            display: block;
        }

        button.active {
            background-color: #b30086;
            color: white;
        }

        h1 {
            font-size: 32px;
            margin-bottom: 30px;
        }

        h2 {
            font-size: 28px;
            margin-bottom: 20px;
        }

        h3 {
            font-size: 24px;
            margin-bottom: 15px;
        }

        .progress-container {
            width: 100%;
            background-color: #f0f0f0;
            border-radius: 4px;
            margin: 10px 0;
        }

        .progress-bar {
            width: 0%;
            height: 20px;
            background-color: #4CAF50;
            border-radius: 4px;
            transition: width 0.3s ease-in-out;
        }

        .score-display {
            text-align: center;
            font-size: 18px;
            margin: 10px 0;
            font-weight: bold;
        }

        .drawing-container {
            margin: 20px 0;
            text-align: center;
        }

        .rectangle-grid {
            display: grid;
            gap: 2px;
            width: 300px;
            margin: 0 auto;
            background: #eee;
            padding: 2px;
        }

        .grid-cell {
            aspect-ratio: 1;
            background: white;
            border: 1px solid #ddd;
        }

        .grid-cell.highlighted {
            background: #ff6b6b;
        }

        .circle-container {
            width: 120px;
            height: 120px;
            position: relative;
            margin: 10px;
        }

        .circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            position: relative;
            border: 2px solid #333;
            background: white;
            overflow: hidden;
        }

        .circle-segment {
            position: absolute;
            width: 100%;
            height: 100%;
            background: white;
            transform-origin: center;
            clip-path: polygon(50% 50%, 50% 0%);
        }

        .circle-segment::after {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            width: 1px;
            height: 50%;
            background: #333;
            transform-origin: bottom;
        }

        .circle-segment.highlighted {
            background: #4a90e2;
        }

        .drawing-caption {
            margin-top: 10px;
            font-style: italic;
            color: #666;
        }
    </style>
</head>

<body>
    <h1>לומדת הכנה למבחן מיון במתמטיקה</h1>
    <div class="topic-selector">
        <h2>בחר נושא:</h2>
        <select id="topicSelector" onchange="loadSelectedTopic()">
            <option value="">בחר נושא...</option>
        </select>
    </div>
    <div class="module" id="currentModule" style="display: none">
        <h2><span id="moduleTitle"></span></h2>

        <div class="navigation-buttons">
            <button id="explanationBtn" onclick="showSection('explanation')">הסברים</button>
            <button id="examplesBtn" onclick="showSection('examples')">דוגמאות</button>
            <button id="quizBtn" onclick="showSection('quiz')">תרגול</button>
        </div>

        <div id="explanationSection" class="section-content">
            <h3>הסברים</h3>
            <div id="explanationContent"></div>
        </div>

        <div id="examplesSection" class="section-content">
            <h3>דוגמאות</h3>
            <div id="exampleContent"></div>
        </div>

        <div id="quizSection" class="section-content">
            <h3>תרגול</h3>
            <div class="progress-container">
                <div id="progressBar" class="progress-bar"></div>
            </div>
            <div class="score-display">
                תשובות נכונות: <span id="correctAnswers">0</span> מתוך <span id="totalAnswers">0</span>
            </div>
            <div class="question">
                <p><span id="questionText"></span></p>
                <div class="options" id="optionsContainer"></div>
                <p class="feedback" id="feedback"></p>
            </div>
            <div class="navigation-buttons">
                <button id="nextQuestionBtn" onclick="loadNextQuestion()" disabled>שאלה הבאה</button>
            </div>
        </div>
    </div>
    <script>const learningContent = {};</script>

    <script src="topics/algebra.js"></script>
    <script src="topics/combinatorics.js"></script>
    <script src="topics/decimals.js"></script>
    <script src="topics/fractions.js"></script>
    <script src="topics/inequalities.js"></script>
    <script src="topics/word-problems.js"></script>
    <script>
        const moduleContainer = document.getElementById("currentModule");
        const moduleTitleElement = document.getElementById("moduleTitle");
        const explanationContentElement = document.getElementById("explanationContent");
        const exampleContentElement = document.getElementById("exampleContent");
        const questionTextElement = document.getElementById("questionText");
        const optionsContainer = document.getElementById("optionsContainer");
        const feedbackElement = document.getElementById("feedback");
        const prevQuestionBtn = document.getElementById("prevQuestionBtn");
        const nextQuestionBtn = document.getElementById("nextQuestionBtn");
        const progressBar = document.getElementById("progressBar");
        const correctAnswersElement = document.getElementById("correctAnswers");
        const totalAnswersElement = document.getElementById("totalAnswers");

        let currentModuleIndex = 0;
        let currentQuestionIndex = 0;
        let currentModuleKey;
        let currentModuleData;
        let currentQuizQuestions;
        let correctAnswers = 0;
        let answeredQuestions = 0;
        let currentQuestionAnswered = false;
        let availableTopics = [];
        let currentTopic = null;


        // Add this after your existing variable declarations
        // ... existing code ...

        // Replace the existing audio definition with this one
        // Replace the existing audio definition with this simpler version
        const correctSound = new Audio();
        correctSound.src = 'data:audio/wav;base64,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';        //const correctSound = new Audio('data:audio/mpeg;base64,//uQxAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAADAAAGhgBVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVWqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqr///////////////////////////////////////////8AAAA8TEFNRTMuMTAwBLkAAAAAAAAAABUgJAMGQQABmgAABoYX3xwmAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//sQxAADwAABpAAAACAAADSAAAAETEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVQ==');
        //correctSound.src = ('data:audio/mp3;base64,SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4LjIwLjEwMAAAAAAAAAAAAAAA//uQwAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAAGAAADAABgYGBgYGBgYGBgYGBgYGCMjIyMjIyMjIyMjIyMjIy4uLi4uLi4uLi4uLi4uLjk5OTk5OTk5OTk5OTk5OT////////////////////////////////8AAAA5TEFNRTMuMTAwBK8AAAAAAAAAABUgJANAQQABmgAAAwDYxP2qAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//sQxAADwAABpAAAACAAADSAAAAETEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV');
        correctSound.load();




        function createConfetti() {
            const container = document.createElement('div');
            container.className = 'confetti-container';

            // Position container in middle of screen
            container.style.cssText = `
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 300px;
        height: 300px;
        pointer-events: none;
        z-index: 9999;
    `;

            document.body.appendChild(container);
            console.log('Created confetti container');

            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.style.cssText = `
            position: absolute;
            width: 10px;
            height: 10px;
            background: ${['#ff0', '#f0f', '#0ff', '#0f0'][Math.floor(Math.random() * 4)]};
            left: 50%;
            top: 50%;
        `;

                container.appendChild(confetti);

                confetti.animate([
                    { transform: 'translate(-50%, -50%) rotate(0deg)', opacity: 1 },
                    {
                        transform: `translate(
                    ${Math.random() * 200 - 100}px, 
                    ${Math.random() * 200 - 100}px
                ) rotate(${Math.random() * 360}deg)`,
                        opacity: 0
                    }
                ], {
                    duration: 1000 + Math.random() * 1000,
                    easing: 'cubic-bezier(0,0,0.2,1)'
                }).onfinish = () => confetti.remove();
            }

            setTimeout(() => {
                container.remove();
                console.log('Removed confetti container');
            }, 2000);
        }

        // Update your checkAnswer function
        function checkAnswer(selectedInput) {
            if (currentQuestionAnswered) return;

            const currentQuestion = currentQuizQuestions[currentQuestionIndex];
            const isCorrect = selectedInput.value === currentQuestion.correctAnswer;

            if (isCorrect) {
                correctAnswers++;
                createConfetti();
                feedbackElement.textContent = "כל הכבוד! תשובה נכונה!";
                feedbackElement.className = "feedback correct";
            } else {
                feedbackElement.textContent = `לא נכון. התשובה הנכונה היא ${String.fromCharCode(1488 + currentQuestion.correctAnswer.charCodeAt(0) - 97)}.`;
                feedbackElement.className = "feedback incorrect";
            }

            // Disable all radio buttons
            document.querySelectorAll('input[name="answer"]').forEach(input => {
                input.disabled = true;
                input.parentElement.classList.add('disabled');
            });

            answeredQuestions++;
            currentQuestionAnswered = true;
            updateScore();
            updateNavigationButtons();
            updateProgress();
        }


        async function initializeApp() {
            await loadAvailableTopics();
            MathJax.startup.defaultReady();
        }

        async function loadAvailableTopics() {
            try {
                // Instead of fetching from PHP, we'll directly use the learningContent object
                const selector = document.getElementById('topicSelector');

                // Clear existing options
                selector.innerHTML = '<option value="">בחר נושא...</option>';

                // Add each topic from learningContent
                Object.keys(learningContent).forEach(topicName => {
                    const option = document.createElement('option');
                    option.value = topicName;
                    option.textContent = topicName;
                    selector.appendChild(option);
                });
            } catch (error) {
                console.error('Failed to load topics:', error);
            }
        }

        async function loadSelectedTopic() {
            const selector = document.getElementById('topicSelector');
            const selectedTopic = selector.value;

            if (!selectedTopic) {
                document.getElementById('currentModule').style.display = 'none';
                return;
            }

            try {
                currentModuleData = learningContent[selectedTopic];
                currentQuizQuestions = currentModuleData.quiz;

                // Reset state
                correctAnswers = 0;
                answeredQuestions = 0;
                currentQuestionIndex = 0;

                // Show module and load content
                document.getElementById('currentModule').style.display = 'block';
                moduleTitleElement.textContent = selectedTopic;
                showSection('explanation');
            } catch (error) {
                console.error('Failed to load topic:', error);
            }
        }

        function loadExplanation() {
            const explanationHTML = currentModuleData.explanation
                .map(item => `<p class="explanation-item">${item.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}</p>`)
                .join('');
            explanationContentElement.innerHTML = explanationHTML;

            // Simplified MathJax typesetting
            MathJax.typesetPromise()
                .then(() => {
                    console.log("MathJax typesetting complete");
                })
                .catch((err) => {
                    console.error("MathJax typesetting failed:", err);
                });
        }

        function loadExamples() {
            console.log('Current module data:', currentModuleData);
            const examplesHTML = currentModuleData.examples
                .map(example => `
            <div class="example-item">
                <p><strong>שאלה:</strong> ${example.question}</p>
                <p><strong>פתרון:</strong> ${example.solution}</p>
                ${example.drawing ? `
                    <div class="drawing-container">
                        ${renderDrawing(example.drawing)}
                    </div>
                ` : ''}
            </div>
        `)
                .join('');
            exampleContentElement.innerHTML = examplesHTML;
            MathJax.typesetPromise();
        }

        function loadQuiz() {
            currentQuestionIndex = 0;
            currentQuestionAnswered = false;
            loadQuestion();
            updateProgress();
            // Add this line to show total questions
            totalAnswersElement.textContent = currentQuizQuestions.length;
        }

        function loadQuestion() {
            if (!currentQuizQuestions || currentQuizQuestions.length === 0) {
                questionTextElement.textContent = "אין שאלות תרגול לנושא זה.";
                optionsContainer.innerHTML = "";
                prevQuestionBtn.disabled = true;
                nextQuestionBtn.disabled = true;
                return;
            }

            const currentQuestion = currentQuizQuestions[currentQuestionIndex];
            questionTextElement.innerHTML = `${currentQuestionIndex + 1}. ${currentQuestion.question}`;
            optionsContainer.innerHTML = currentQuestion.options
                .map((option, index) => `
        <label>
            <input type="radio" 
                   name="answer" 
                   value="${String.fromCharCode(97 + index)}"
                   onchange="checkAnswer(this)">
            ${String.fromCharCode(1488 + index)}. ${option}
        </label>
    `)
                .join('');

            feedbackElement.textContent = "";
            feedbackElement.className = "feedback";
            MathJax.typesetPromise();
            currentQuestionAnswered = false;
            updateNavigationButtons();
        }



        function updateScore() {
            correctAnswersElement.textContent = correctAnswers;
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / currentQuizQuestions.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        function loadPreviousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                loadQuestion();
            }
        }

        function loadNextQuestion() {
            if (currentQuestionIndex < currentQuizQuestions.length - 1 && currentQuestionAnswered) {
                currentQuestionIndex++;
                loadQuestion();
            }
        }

        function updateNavigationButtons() {
            //prevQuestionBtn.disabled = currentQuestionIndex === 0;
            nextQuestionBtn.disabled = !currentQuestionAnswered || currentQuestionIndex === currentQuizQuestions.length - 1;
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section-content').forEach(content =>
                content.classList.remove('active'));
            document.getElementById(sectionId + 'Section').classList.add('active');

            document.querySelectorAll('.navigation-buttons button').forEach(button =>
                button.classList.remove('active'));
            document.getElementById(sectionId + 'Btn').classList.add('active');

            if (sectionId === 'explanation') loadExplanation();
            else if (sectionId === 'examples') loadExamples();
            else if (sectionId === 'quiz') loadQuiz();
        }
        function renderDrawing(drawing) {
            switch (drawing.type) {
                case 'rectangleGrid':
                    return renderRectangleGrid(drawing);
                case 'circle':
                    return renderCircle(drawing);
                case 'rectangleStrip':
                    return renderRectangleStrip(drawing);
                case 'fractionCircles':
                    return renderFractionCircles(drawing);
                case 'bitCombinations':  // Add this case
                    return renderBitCombinations(drawing);
                default:
                    return '';
            }
        }

        // Add this new function
        function renderBitCombinations({ bits, examples, highlight, caption }) {
            const container = document.createElement('div');
            container.className = 'bit-combinations';
            container.style.cssText = `
        font-family: monospace;
        font-size: 1.2em;
        text-align: center;
        padding: 10px;
        background: #f5f5f5;
        border-radius: 4px;
    `;

            const examplesHTML = examples.map(example => {
                const chars = example.split('').map((char, i) => {
                    const isHighlighted = highlight?.positions?.includes(i + 1);
                    return `<span style="color: ${isHighlighted ? '#ff4444' : '#333'}">${char}</span>`;
                }).join('');
                return `<div>${chars}</div>`;
            }).join('');

            if (highlight?.choices) {
                const choicesHTML = `
            <div style="margin-top: 10px; color: #666;">
                אפשרויות לכל עמודה: ${highlight.choices.join(', ')}
            </div>
        `;
                container.innerHTML = examplesHTML + choicesHTML;
            } else {
                container.innerHTML = examplesHTML;
            }

            return `
        <div class="drawing-container">
            ${container.outerHTML}
            ${caption ? `<div class="drawing-caption">${caption}</div>` : ''}
        </div>
    `;
        }
        function renderRectangleGrid({ rows, cols, highlightCells, caption }) {
            const grid = document.createElement('div');
            grid.className = 'rectangle-grid';
            grid.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;

            for (let i = 0; i < rows * cols; i++) {
                const cell = document.createElement('div');
                cell.className = 'grid-cell';

                // Check which category this cell belongs to
                if (highlightCells.worker1?.includes(i)) {
                    cell.style.backgroundColor = '#4a90e2'; // blue for worker 1
                } else if (highlightCells.worker2?.includes(i)) {
                    cell.style.backgroundColor = '#e24a4a'; // red for worker 2
                } else if (highlightCells.together?.includes(i)) {
                    cell.style.backgroundColor = '#9c27b0'; // purple for working together
                }

                grid.appendChild(cell);
            }

            return `
        <div class="drawing-container">
            ${grid.outerHTML}
            ${caption ? `<div class="drawing-caption">${caption}</div>` : ''}
        </div>
    `;
        }
        function renderCircle({ divisions, highlightSections, caption }) {
            let segments = '';
            const angle = 360 / divisions;

            for (let i = 0; i < divisions; i++) {
                const isHighlighted = highlightSections.includes(i + 1);
                segments += `
            <div class="circle-segment ${isHighlighted ? 'highlighted' : ''}" 
                 style="clip-path: polygon(50% 50%, 50% 0%, ${getArcPoints(angle)}); 
                        transform: rotate(${i * angle}deg);">
            </div>`;
            }

            return `<div class="circle-container"><div class="circle">${segments}</div></div>`;
        }

        function getArcPoints(angle) {
            let points = '50% 0%';
            for (let i = 1; i <= angle; i++) {
                const rad = i * Math.PI / 180;
                const x = 50 + 50 * Math.sin(rad);
                const y = 50 - 50 * Math.cos(rad);
                points += `, ${x}% ${y}%`;
            }
            return points + ', 50% 50%';
        }



        function renderRectangleStrip({ divisions, highlights, caption }) {
    const strip = document.createElement('div');
    strip.className = 'rectangle-grid';
    strip.style.gridTemplateColumns = `repeat(${divisions}, 1fr)`;

    for (let i = 0; i < divisions; i++) {
        const cell = document.createElement('div');
        cell.className = 'grid-cell';
        
        // Check which category this cell belongs to
        if (highlights.first?.includes(i + 1)) {
            cell.style.backgroundColor = '#4a90e2'; // blue
        } else if (highlights.second?.includes(i + 1)) {
            cell.style.backgroundColor = '#e24a4a'; // red
        } else if (highlights.combined?.includes(i + 1)) {
            cell.style.backgroundColor = '#9c27b0'; // purple
        } else if (highlights.remaining?.includes(i + 1)) {
            cell.style.backgroundColor = '#4caf50'; // green
        }
        
        strip.appendChild(cell);
    }

    return `
        <div class="drawing-container">
            ${strip.outerHTML}
            ${caption ? `<div class="drawing-caption">${caption}</div>` : ''}
        </div>
    `;
}

        function renderFractionCircles({ fractions, caption }) {
            const circles = fractions.map(fraction => {
                const [num, den] = fraction.split('/').map(Number);
                return renderCircle({
                    divisions: den,
                    highlightSections: Array.from({ length: num }, (_, i) => i + 1),
                    caption: null
                });
            }).join('');

            return `
        <div class="drawing-container" style="display: flex; justify-content: center; gap: 40px;">
            ${circles}
            ${caption ? `<div class="drawing-caption">${caption}</div>` : ''}
        </div>
    `;
        }
    </script>
</body>

</html>